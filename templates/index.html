<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ensure proper mobile scaling -->
    <title>Harp & Soph Life Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"> <!-- Use Google Fonts for consistency -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif; /* More readable font */
            background-color: #ffccf9; /* Light pink background */
            text-align: center;
            padding: 20px;
            margin: 0;
        }
        h1, h2 {
            color: #ff66cc; /* Soft pink color for the headings */
        }
        table {
    	    width: auto; /* Only as wide as its content requires */
            margin: 20px auto;
            border-collapse: collapse;
            border-radius: 15px; /* Rounded corners for the table */
            overflow: hidden; /* Ensures the rounded corners affect child elements */
            box-shadow: 0 0 10px #888888; /* Soft shadow for depth */
	}
        th, td {
            border: 1px solid #ff99cc; /* Light pink border for table cells */
            padding: 9px;
            text-align: left;           
            border-radius: 10px; /* Rounded corners for table cells */
        }
        th {
            background-color: #ff66cc; /* Deeper pink for the header */
            color: white;
            font-size: 1.2em;
        }
        tr:nth-child(even) {
            background-color: #ffccf9; /* Light pink for even rows */
        }
        tr:hover {
            background-color: #ffb3e6; /* Slightly darker pink on hover */
        }
	@media (max-width: 768px) {
    th, td {
        padding: 4px 6px; /* Even smaller padding for smaller screens */
        font-size: smaller; /* Reduce font size on small screens */
    }
    table {
        width: 100%; /* Full width on smaller screens */
        max-width: none; /* Override max-width of 80% */
        box-sizing: border-box; /* Include padding and border in the width */
    }
}
        .content-image {
            max-width: 100%; /* Full width on smaller screens */
            height: auto;
            display: block;
            margin: 20px auto;
            cursor: pointer; /* Indicates the image can be clicked */
        }
        @media (min-width: 768px) { /* For desktop screens */
            .content-image {
                max-width: 50%; /* Adjust to a reasonable size on desktop */
            }
        }
        /* Gallery overlay styling */
#galleryOverlay {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1001; /* Sit on top */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
    padding-top: 50px; /* Adds some space at the top */
}

/* Close button */
.closeBtn {
    position: fixed;
    top: 15px;
    right: 35px;
    color: #fff;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
}

/* Gallery container */
.gallery-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    padding: 0 4px;
}

/* Gallery images */
.galleryImg {
    margin: 10px;
    max-width: 90%;
    width: auto; /* Adjust width to maintain aspect ratio */
    max-height: 400px; /* Limiting the height for larger displays */
    transition: transform 0.2s; /* Animation */
    cursor: pointer; /* Indicates the image can be clicked */
}

@media (min-width: 768px) { /* For desktop screens */
    .galleryImg {
        max-width: 45%; /* Adjust to display more images in a row on desktop */
    }
}

@media (min-width: 1024px) { /* Larger desktop screens */
    .galleryImg {
        max-width: 30%; /* Further adjust for larger screens */
    }
}
        .galleryImg:hover {
            transform: scale(1.1); /* Slight zoom on hover */
        }

@keyframes splatterAnimation {
    0% {
        transform: scale(0); /* Start from nothing */
        opacity: 0; /* Start from fully transparent */
    }
    30% {
        transform: scale(5); /* Quickly scale up as if splattering on the screen */
        opacity: .7; /* Fully visible */
    }
    60% {
        transform: scale(1.5); /* Scale back to normal size */
        opacity: 1; /* Still fully visible */
    }
    100% {
        transform: scale(1); /* Remain at normal size */
        opacity: 0; /* Fully fade out */
    }
}

.animate {
    animation: splatterAnimation 3s ease forwards .5s}

#splatter {
    position: absolute;
    top: -20vh; /* Center vertically in the parent */
    left: 20%; /* Center horizontally in the parent */
    transform: translate(-50%, -50%) rotate(0deg); /* Correctly center and apply initial rotation */
    opacity: 0; /* Initially invisible */
    width: auto;
    max-width: 90%; /* Ensure it doesn't overflow its container */
    z-index: 2; /* Ensure it's above other content but below overlays */
}
@media (max-width: 768px) {
    #splatter {
        max-width: 80%; /* Adjust size for smaller screens */
        /* Consider adjusting 'top' and 'left' values if necessary */
    }
}

    </style>
</head>
<body>
    <div id="currentDateTime" class="timestamp"></div>
    <div class="timestamp">Last Updated On: {{ last_updated }}</div>

    <script>
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
            };
            document.getElementById("currentDateTime").innerHTML = now.toLocaleString("en-US", options);
        }
        updateDateTime(); // Run once on load
        setInterval(updateDateTime, 1000); // Update every second
        // Function to toggle gallery overlay
        function toggleGallery(show) {
            document.getElementById('galleryOverlay').style.display = show ? 'block' : 'none';
        }
    </script>

    <h1>Harper and Sophie's Life Tracker</h1>
    <!-- Clickable feature image that opens the gallery -->
    <img src="{{ url_for('static', filename='assets/hospital_images/girlsbasket.jpg') }}" alt="Photo of the girls in basket day 2 of life" class="content-image" onclick="toggleGallery(true)">

    <!-- Gallery Overlay -->
    <div id="galleryOverlay">
        <span class="closeBtn" onclick="toggleGallery(false)">&times;</span>
        <!-- Dynamically loaded images from Flask -->
        {% for image in image_files %}
        <img src="{{ url_for('static', filename=image) }}" class="galleryImg" alt="Gallery Image">
        {% endfor %}
    </div>

    <h2>Last Event Times</h2>
    <div style="display: flex; justify-content: space-around;">
        <div>
            <h3>Feedings</h3>
            <table>
                <tr>
                    <th>Activity Type</th>
                    <th>Last Time</th>
                </tr>
                {% for key, time in last_event_times['Feeding'].items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ time }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        <div>
            <h3>Diapers</h3>
            <table>
                <tr>
                    <th>Activity Type</th>
                    <th>Last Time</th>
                </tr>
                {% for key, time in last_event_times['Diapers'].items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ time }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <h2>Add Note or Reminder</h2>
    <form id="noteForm">
        <label for="noteText">Note:</label><br>
        <textarea id="noteText" name="noteText" rows="4" cols="50"></textarea><br>
        <input type="button" value="Submit" onclick="submitNote()">
      </form>
      <a href="/notes">View Notes</a>
      <div>
      <div style="display: flex; justify-content: space-around;">
      <div>
      <h2>Today's Counts</h2>
      <table>
          <tr>
              <th>Activity Type</th>
              <th>Today's Count</th>
          </tr>
          {% for key, count in today_counts.items() %}
          <tr>
              <td>{{ key }}</td>
              <td>{{ count }}</td>
          </tr>
          {% endfor %}
      </table>
    </div>
    <div>
      <h2>Average Counts Per Day</h2>
      <table>
          <tr>
              <th>Activity Type</th>
              <th>Average Count</th>
          </tr>
          {% for key, avg in average_counts_per_day.items() %}
          <tr>
              <td>{{ key }}</td>
              <td>{{ avg }}</td>
          </tr>
          {% endfor %}
      </table>
    </div>
</div>

    <h2>Harper's Activity</h2>
<canvas id="harperChart"></canvas>

<h2>Sophie's Activity</h2>
<canvas id="sophieChart"></canvas>
    
    <h2>Events in the Last 3 Days</h2>
<div style="display: flex; flex-wrap: wrap; justify-content: space-around;">
    {% for category, labels in events_last_3_days.items() %}
        <div style="margin: 10px;">
            <h3>{{ category }}</h3>
            <div style="margin-bottom: 20px; border: 1px solid #ff99cc; border-radius: 15px; overflow: hidden; box-shadow: 0 0 10px #888888;">
                {% for label, events in labels.items() %}
                    <h4 style="background-color: #ff66cc; color: white; margin: 0; padding: 4px;">{{ label }}</h4>
                    <table style="width: 100%; margin-bottom: 0; border-radius: 0;">
                        <tbody>
                            {% for event in events %}
                                <tr>
                                    <td style="padding: 4px; border-bottom: 1px solid #ff99cc;">{{ event.timestamp.split(' at ')[0] }}</td>
                                    <td style="padding: 4px; border-bottom: 1px solid #ff99cc;">{{ event.timestamp.split(' at ')[1] }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>
<div id="diaperCountSection" style="text-align:center; margin-top:20px; margin-bottom:20px; position: relative; background-color: #FFA07A;">
    <h2>Diaper Dashboard</h2>
    <p>Keeping track of the twins' adventures in diaper land!</p>
    <img id="splatter" src="{{ url_for('static', filename='assets/images/SplatterImage.svg') }}" />
    <div id="diaperCount" style="font-size:48px; font-weight:bold; color:#9ACD32; position: relative;">0</div>
    <h2>More to come...💩</h2>
    <div style="height:300px;></div> <!-- This div adds extra space below the diaper count section -->
    <!-- This space intentionally left blank to create a margin -->
</div>
    <script>
        // Add this script at the bottom, before closing </body> tag
        var harperData = JSON.parse('{{ harper_data_json | safe }}');
        var sophieData = JSON.parse('{{ sophie_data_json | safe }}');
        
        const harperCtx = document.getElementById('harperChart').getContext('2d');
        const sophieCtx = document.getElementById('sophieChart').getContext('2d');

        const harperChart = new Chart(harperCtx, {
    type: 'line', // Change chart type to line
    data: {
        labels: harperData.dates,
        datasets: [{
            label: 'Feedings',
            data: harperData.data.Feeding,
            borderColor: 'rgba(255, 99, 132, 1)',
            fill: false,
            tension: 0.1 // Smooth the line
        }, {
            label: 'Pees',
            data: harperData.data.Pee,
            borderColor: 'rgba(54, 162, 235, 1)',
            fill: false,
            tension: 0.1 // Smooth the line
        }, {
            label: 'Poos',
            data: harperData.data.Poo,
            borderColor: 'rgba(255, 206, 86, 1)',
            fill: false,
            tension: 0.1 // Smooth the line
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
const sophieChart = new Chart(sophieCtx, {
    type: 'line', // Change chart type to line
    data: {
        labels: sophieData.dates,
        datasets: [{
            label: 'Feedings',
            data: sophieData.data.Feeding,
            borderColor: 'rgba(255, 99, 132, 1)',
            fill: false,
            tension: 0.1 // Smooth the line
        }, {
            label: 'Pees',
            data: sophieData.data.Pee,
            borderColor: 'rgba(54, 162, 235, 1)',
            fill: false,
            tension: 0.1 // Smooth the line
        }, {
            label: 'Poos',
            data: sophieData.data.Poo,
            borderColor: 'rgba(255, 206, 86, 1)',
            fill: false,
            tension: 0.1 // Smooth the line
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
<script>
    function submitNote() {
        var noteText = document.getElementById('noteText').value;
        fetch('/add_note', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'noteText=' + encodeURIComponent(noteText)
        })
        .then(response => response.text())
        .then(data => {
            alert(data); // Show success message
            document.getElementById('noteText').value = ''; // Clear the form
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
    </script>
   <script>
	document.addEventListener("DOMContentLoaded", function() {
    let observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                let splatter = document.getElementById('splatter');
                // Delay the start of the splatter animation
                setTimeout(() => {
                    splatter.classList.add('animate'); // Start the splatter animation after a delay
                }, 1000); // Delay the animation by 1000 milliseconds (1 second)

                // Another timeout to fade the splatter image and show the number
                setTimeout(() => {
                    splatter.style.opacity = 0; // Make the splatter invisible
                    animateValue("diaperCount", 0, {{ diaper_count }}, 2000); // Start the count animation
                }, 3000); // This timeout should be the sum of the animation delay and duration

                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.5, rootMargin: "0px" });

    observer.observe(document.getElementById('diaperCountSection'));
});
</script>
<script>
function animateValue(id, start, end, duration) {
    let obj = document.getElementById(id);
    let range = end - start;
    let current = start;
    let increment = end > start ? 1 : -1;
    let stepTime = Math.abs(Math.floor(duration / range));

    // Make sure we have a non-zero stepTime
    stepTime = Math.max(stepTime, 10);

    let timer = setInterval(function() {
        current += increment;
        obj.textContent = current;
        if (current == end) {
            clearInterval(timer);
            obj.style.opacity = 1; // Make the diaper count visible
        }
    }, stepTime);
}</script>
</body>
</html>

